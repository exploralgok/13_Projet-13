(()=>{"use strict";new class{constructor(){this.togglesWithChildren=document.querySelectorAll(".toggle-with-children"),this.events(),this.showCheckedToggelsChildren()}events(){this.togglesWithChildren.forEach((e=>{e.addEventListener("change",(()=>this.toggleWithChildrenChecked(e)))}))}showCheckedToggelsChildren(){this.togglesWithChildren.forEach((e=>{this.toggleWithChildrenChecked(e)}))}toggleWithChildrenChecked(e){let t=e.closest(".form-table");if(!t)return;let i=t.querySelector(".form-table.children");i&&(e.checked?i.classList.add("show"):i.classList.remove("show"))}},new class{constructor(){this.sliders=document.querySelectorAll("input[type=range]"),this.events()}events(){this.sliders.forEach((e=>{this.addValueToCss(e),e.addEventListener("input",(e=>{let t=e.target,i=this.addValueToCss(t),s=t.nextElementSibling.querySelector(".value-num");s&&(s.innerHTML=i)}))}))}addValueToCss(e){let t=e.value;return e.parentNode.style.setProperty("--value",t),e.parentNode.style.setProperty("--min",e.min),e.parentNode.style.setProperty("--max",e.max),t}},new class{constructor(){this.popupContainer=document.querySelector(".quickwebp-preview__popup"),this.btnOpenPopup=document.querySelector(".quickwebp-preview__open__btn"),this.btnClosePopup=document.querySelector(".quickwebp-preview__popup__close"),this.btnAddFile=document.querySelector(".quickwebp-preview__popup__file__btn"),this.inputAddFile=document.querySelector(".quickwebp-preview__popup__file__input"),this.sectionFile=document.querySelector(".quickwebp-preview__popup__file"),this.sectionCompare=document.querySelector(".quickwebp-preview__popup__compare"),this.sectionCompareHandle=document.querySelector(".quickwebp-preview__popup__compare__handle"),this.sectionCompareOriginal=document.querySelector(".quickwebp-preview__popup__compare__images__original"),this.sectionCompareOriginalImg=document.querySelector(".quickwebp-preview__popup__compare__images__original .image"),this.sectionCompareNew=document.querySelector(".quickwebp-preview__popup__compare__images__new"),this.sectionCompareNewImg=document.querySelector(".quickwebp-preview__popup__compare__images__new .image"),this.sectionCompareDataOriginalSize=document.querySelector(".quickwebp-preview__popup__compare__data__original__size"),this.sectionCompareDataNewType=document.querySelector(".quickwebp-preview__popup__compare__data__new__type"),this.sectionCompareDataNewSize=document.querySelector(".quickwebp-preview__popup__compare__data__new__size"),this.sectionCompareDataNewGain=document.querySelector(".quickwebp-preview__popup__compare__data__new__gain"),this.sectionSpiner=document.querySelector(".quickwebp-preview__popup__spiner"),this.drag=!1,this.xPos=0,this.leftPos=0,this.events()}events(){this.btnOpenPopup.addEventListener("click",(e=>{e.preventDefault(),this.openPopup()})),this.btnClosePopup.addEventListener("click",(e=>{e.preventDefault(),this.closePopup()})),this.btnAddFile.addEventListener("click",(()=>{this.inputAddFile.click()})),this.inputAddFile.addEventListener("change",(()=>this.newImageAdded())),window.addEventListener("resize",(()=>this.handlePositionInResize())),this.sectionCompareHandle.addEventListener("mousedown",(e=>this.handleMouseDown(e))),this.sectionCompare.addEventListener("mousemove",(e=>this.handleMouseMove(e))),this.sectionCompareHandle.addEventListener("mouseup",(()=>this.handleMouseUp())),this.sectionCompare.addEventListener("mouseleave",(e=>this.handleMouseUp()))}newImageAdded(){this.HideFileSection(),this.showSpinerSection();let e=this.inputAddFile.files;if(e.length<1)return this.HideSpinerSection(),void this.showFileSection();let t=this.getSettings(),i={};for(const e in t)Object.hasOwnProperty.call(t,e)&&(i[e]=t[e]);let s=new FormData;s.append("action","image_optimizition_ajax"),s.append("nonce",QUICKWEBP_ADMIN_SETTINGS.nonce),s.append("file",e[0]),s.append("settings",JSON.stringify(i));let o={method:"POST",body:s,redirect:"follow"};fetch(QUICKWEBP_ADMIN_SETTINGS.ajaxUrl,o).then((e=>e.json())).then((t=>{if(this.HideSpinerSection(),t.success){let i=t.data,s=this.getValueInBytes(i.size),o=4*Math.ceil(i.image.length/3)*.5624896334383812,n=this.getValueInBytes(o),r=100-o/i.size*100,a=r>0?"-":"+",c={image:(window.URL?URL:webkitURL).createObjectURL(e[0]),name:i.original_name,type:i.type,size:s.value+" "+s.unit};this.showOriginalData(c);let p={image:i.image,name:i.name,type:i.new_type,size:n.value+" "+n.unit,gain:a+Math.abs(r.toFixed(2))+" %"};this.showNewData(p),this.showCompareSection()}else this.showFileSection()})).catch((e=>{console.log("ERROR: ",e),this.HideSpinerSection(),this.showFileSection()}))}getSettings(){let e=document.querySelector("#quickwebp_settings_conversion"),t=document.querySelector("#quickwebp_settings_conversion_quality"),i=document.querySelector("#quickwebp_settings_conversion_sharpen"),s=document.querySelector("#quickwebp_settings_conversion_ignore_webp-0"),o=document.querySelector("#quickwebp_settings_resize"),n=document.querySelector("#quickwebp_settings_resize_value"),r=document.querySelector("#quickwebp_settings_completion"),a=document.querySelector("#quickwebp_settings_completion_options-0"),c=document.querySelector("#quickwebp_settings_completion_options-1"),p=document.querySelector("#quickwebp_settings_completion_options-2"),l=document.querySelector("#quickwebp_settings_completion_options-3"),h=document.querySelector("#quickwebp_settings_cleanup"),d=document.querySelector("#quickwebp_settings_library");return{quickwebp_settings_conversion:e&&e.checked?e.value:"",quickwebp_settings_conversion_quality:t?t.value:"",quickwebp_settings_conversion_sharpen:i?i.value:"",quickwebp_settings_conversion_ignore_webp:[s&&s.checked?s.value:""],quickwebp_settings_resize:o&&o.checked?o.value:"",quickwebp_settings_resize_value:n?n.value:"",quickwebp_settings_completion:r&&r.checked?r.value:"",quickwebp_settings_completion_options:[a&&a.checked?a.value:"",c&&c.checked?c.value:"",p&&p.checked?p.value:"",l&&l.checked?l.value:""],quickwebp_settings_cleanup:h&&h.checked?h.value:"",quickwebp_settings_library:d?d.value:""}}showOriginalData(e){this.sectionCompareOriginalImg.style.backgroundImage="url("+e.image+")",this.sectionCompareDataOriginalSize.innerHTML=e.size}showNewData(e){this.sectionCompareNewImg.style.backgroundImage="url("+e.image+")",this.sectionCompareDataNewType.innerHTML=e.type,this.sectionCompareDataNewSize.innerHTML=e.size,this.sectionCompareDataNewGain.innerHTML=e.gain}handleMouseDown(e){this.leftPos=window.getComputedStyle(this.sectionCompareHandle).getPropertyValue("left"),this.xPos=e.clientX,this.drag=!0}handleMouseMove(e){if(this.drag){let t=this.sectionCompare.offsetWidth,i=e.clientX-this.xPos,s=parseFloat(this.leftPos)+i,o=s/t*100;o=o<0?0:o,o=o>100?100:o;let n=100-o;this.sectionCompareHandle.style.left=s+"px",this.sectionCompareNew.style.left=o+"%",this.sectionCompareNewImg.style.left="-"+o+"%",this.sectionCompareOriginal.style.left="-"+n+"%",this.sectionCompareOriginalImg.style.left=n+"%"}}handlePositionInResize(){let e=this.sectionCompare.offsetWidth,t=parseFloat(window.getComputedStyle(this.sectionCompareHandle).getPropertyValue("left"))/e*100;t=t<0?0:t,t=t>100?100:t;let i=100-t;this.sectionCompareNew.style.left=t+"%",this.sectionCompareNewImg.style.left="-"+t+"%",this.sectionCompareOriginal.style.left="-"+i+"%",this.sectionCompareOriginalImg.style.left=i+"%"}getValueInBytes(e){let t=0,i="";return e<1024?(t=e,i="bytes"):e<1048576?(t=(e/1024).toFixed(2),i="KB"):(t=(e/1048576).toFixed(2),i="MB"),{value:t,unit:i}}handleMouseUp(){this.drag=!1}openPopup(){document.body.style.overflowY="hidden",this.popupContainer.classList.add("open")}closePopup(){document.body.style.overflowY="auto",this.popupContainer.classList.remove("open"),this.sectionCompareOriginalImg.style.backgroundImage="",this.sectionCompareNewImg.style.backgroundImage="",this.sectionCompareDataOriginalSize.innerHTML="",this.sectionCompareDataNewType.innerHTML="",this.sectionCompareDataNewSize.innerHTML="",this.HideSpinerSection(),this.hideCompareSection(),this.showFileSection()}showFileSection(){this.inputAddFile.value="",this.sectionFile.classList.add("show")}HideFileSection(){this.sectionFile.classList.remove("show")}showCompareSection(){this.sectionCompare.classList.add("show")}hideCompareSection(){this.sectionCompare.classList.remove("show")}showSpinerSection(){this.sectionSpiner.classList.add("show")}HideSpinerSection(){this.sectionSpiner.classList.remove("show")}},new class{constructor(){this.startBtn=document.querySelector(".quickwebp-bulk-optimization-btn-start"),this.stopBtn=document.querySelector(".quickwebp-bulk-optimization-btn-stop"),this.progressBar=document.querySelector(".quickwebp-bulk-optimization-progress"),this.progressBarInner=document.querySelector(".quickwebp-bulk-optimization-progress-inner"),this.progressBarProgress=document.querySelector(".quickwebp-bulk-optimization-progress-progress"),this.messageText=document.querySelector(".quickwebp-bulk-optimization-message"),this.events(),this.checkProgress()}events(){this.startBtn.addEventListener("click",(e=>this.startOptimization(e))),this.stopBtn.addEventListener("click",(e=>this.stopOptimization(e)))}checkProgress(){this.checkProgressInterval=setInterval((()=>{let e=new FormData;e.append("action","check_bulk_optimization_progress"),e.append("nonce",QUICKWEBP_ADMIN_SETTINGS.nonce);let t={method:"POST",body:e,redirect:"follow"};fetch(QUICKWEBP_ADMIN_SETTINGS.ajaxUrl,t).then((e=>e.json())).then((e=>{e.success&&(this.addProgressText(e.data.progress),this.updateProgressBar(e.data.percent),e.data.running||(this.hideStopBtn(),this.showStartBtn(),clearInterval(this.checkProgressInterval)))})).catch((e=>{console.log("ERROR: ",e),this.hideStartSpinner()}))}),5e3)}startOptimization(e){e.preventDefault(),this.emptyMessageText(),this.showStartSpinner();let t=new FormData;t.append("action","start_bulk_optimization"),t.append("nonce",QUICKWEBP_ADMIN_SETTINGS.nonce);let i={method:"POST",body:t,redirect:"follow"};fetch(QUICKWEBP_ADMIN_SETTINGS.ajaxUrl,i).then((e=>e.json())).then((e=>{this.hideStartSpinner(),e.success?(this.hideStartBtn(),this.showStopBtn(),this.showProgressBar(),this.addProgressText(e.data.progress),this.updateProgressBar(e.data.percent),this.checkProgress()):this.addMessageText(e.data)})).catch((e=>{console.log("ERROR: ",e),this.hideStartSpinner()}))}stopOptimization(e){e.preventDefault(),this.emptyMessageText();let t=new FormData;t.append("action","stop_bulk_optimization"),t.append("nonce",QUICKWEBP_ADMIN_SETTINGS.nonce);let i={method:"POST",body:t,redirect:"follow"};fetch(QUICKWEBP_ADMIN_SETTINGS.ajaxUrl,i).then((e=>e.json())).then((e=>{e.success?(this.hideStopBtn(),this.showStartBtn(),this.hideProgressBar(),this.clearInterval(this.checkProgressInterval)):this.addMessageText(e.data)})).catch((e=>{console.log("ERROR: ",e)}))}showStartSpinner(){this.startBtn.classList.add("show-spinner")}hideStartSpinner(){this.startBtn.classList.remove("show-spinner")}showStartBtn(){this.startBtn.classList.add("show")}hideStartBtn(){this.startBtn.classList.remove("show")}showStopBtn(){this.stopBtn.classList.add("show")}hideStopBtn(){this.stopBtn.classList.remove("show")}showProgressBar(){this.progressBar.classList.add("show")}hideProgressBar(){this.progressBar.classList.remove("show")}addMessageText(e){this.messageText.innerHTML=e}emptyMessageText(){this.messageText.innerHTML=""}addProgressText(e){this.progressBarProgress.innerHTML=e}updateProgressBar(e){this.progressBarInner.style.width=e}}})();